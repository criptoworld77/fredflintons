<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fred Flintons (FRED) ‚Äî Stone Age Memecoin</title>
<meta name="description" content="Fred Flintons (FRED) ‚Äî The Stone Age memecoin for the Crypto Era. Play the Meme Game, generate memes, and explore tokenomics (Solana).">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%F0%9F%AA%A8%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --bg:#0f0e0d; --bg2:#161410; --panel:#171410dd;
    --text:#efe9df; --muted:#bfb6a8;
    --stone:#a69782; --stone-2:#cbbda2;
    --accent:#ffd27a; --accent-2:#ff9e4a;
    --ok:#67d27a; --danger:#ff6b6b;
    --line:rgba(255,255,255,.06); --shadow:0 14px 40px rgba(0,0,0,.45);
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    background:
      radial-gradient(1200px 800px at 10% -20%, rgba(42,37,31,.45) 0%, transparent 60%),
      radial-gradient(1200px 800px at 110% 120%, rgba(47,39,31,.35) 0%, transparent 60%),
      linear-gradient(180deg,var(--bg),var(--bg2));
    color:var(--text); -webkit-font-smoothing:antialiased;
    line-height:1.5;
  }
  a{color:var(--accent); text-decoration:none}
  .container{max-width:1150px; margin:0 auto; padding:18px}
  header{position:sticky; top:0; z-index:40; backdrop-filter:blur(8px); background:linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.12)); border-bottom:1px solid var(--line)}
  .nav{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0}
  .brand{display:flex; gap:12px; align-items:center; font-weight:800}
  .brand .logo-img{height:32px; width:auto; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,.25)}
  .navlinks{display:flex; gap:12px}
  @media (max-width:900px){ .navlinks{display:none} }
  .btn{display:inline-flex; gap:8px; align-items:center; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; border:1px solid var(--line); background:rgba(255,255,255,.03); color:inherit}
  .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#2b1808; border:none}
  .hero{display:grid; grid-template-columns:1.1fr .9fr; gap:22px; align-items:center; padding:36px 0}
  @media (max-width:900px){ .hero{grid-template-columns:1fr} .nav .controls{display:flex} }
  .panel{background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow)}
  h1{font-size:clamp(30px,5vw,56px); margin:0 0 8px}
  .tagline{color:var(--muted); margin:0 0 12px}
  .pill{border:1px dashed rgba(255,255,255,.04); padding:8px 10px; border-radius:10px}
  .chip{background:rgba(0,0,0,.2); padding:6px 10px; border-radius:999px; font-size:13px; margin-right:8px}
  .rock {
  width: 400px;      /* mesmo tamanho do quadrado original */
  height: 350px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: none;  /* remove o bege */}

  .rock img.fred-stone {
  width: 100%;
  height: 100%;
  object-fit: cover;  /* garante que a imagem preencha sem distorcer */
  border-radius: 12px; /* se quiser manter o arredondado */}

  .float{animation:float 5.5s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0) rotate(-4deg)}50%{transform:translateY(-8px) rotate(-2deg)}}

  /* particles */
  .particles{position:absolute; inset:0; pointer-events:none; overflow:hidden}
  .particle{position:absolute; width:6px; height:6px; border-radius:50%; opacity:.7; filter:blur(.2px)}

  /* sections & grid */
  section{padding:18px 0}
  .grid-cols{display:grid; gap:18px}
  @media(min-width:900px){ .grid-cols.cols-12{grid-template-columns:repeat(12,1fr)} }
  .col-6{grid-column:span 6}.col-8{grid-column:span 8}.col-4{grid-column:span 4}

  /* Game UI */
  #gamePanel{display:grid; gap:10px}
  .scorebar{display:flex; gap:12px; align-items:center; justify-content:space-between}
  .stat{display:flex; gap:8px; align-items:center}
  .progress-thin{height:8px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden}
  .progress-thin > i{display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2))}

  .canvas-wrap{border-radius:10px; overflow:hidden; border:1px solid var(--line)}
  #runnerCanvas{width:100%; height:360px; display:block; background:linear-gradient(180deg,#14100e,#0f0e0d)}

  /* meme generator */
  #memeCanvas{width:100%; height:auto; display:block; max-height:520px; border-radius:8px; background:#0e0d0c}

  footer{margin:40px 0 80px; color:var(--muted); text-align:center}

  /* small helpers */
  .muted{color:var(--muted)}
  input.kbd, .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; padding:8px; border-radius:8px; background:rgba(0,0,0,.28); border:1px solid var(--line); color:inherit}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

  /* helper image styles */
  .hero-slogan{border-radius:12px; width:100%; max-width:720px; display:block; margin:12px auto 0; border:1px solid var(--line)}
</style>
</head>
<body>
<header>
  <div class="container nav" role="navigation" aria-label="Main navigation">
    <div class="brand">
      <!-- Substitu√≠do: emoji ‚Üí imagem do logo -->
      <img class="logo-img" src="img/logo.png" alt="FRED Token Logo">
      <div>
        <div style="font-weight:900">FRED <span style="opacity:.7;font-weight:600">| Fred Flintons</span></div>
        <div class="muted" style="font-size:12px">Stone Age memecoin</div>
      </div>
    </div>

    <nav class="navlinks" aria-label="Sections">
      <a href="#tokenomics" data-i18n="nav.tokenomics">Tokenomics</a>
      <a href="#rockmap" data-i18n="nav.rockmap">Rockmap</a>
      <a href="#howto" data-i18n="nav.howto">How to buy</a>
      <a href="#play" data-i18n="nav.play">Play the Meme Game</a>
      <a href="#meme" data-i18n="nav.meme">Meme Generator</a>
      <a href="#community" data-i18n="nav.community">Community</a>
    </nav>

    <div class="controls row" style="align-items:center">
      <select id="langSelect" class="kbd" aria-label="Language selector">
        <option value="en">English</option>
        <option value="pt">Portugu√™s</option>
      </select>
      <button id="themeBtn" class="btn" aria-label="Toggle theme">üåì</button>
      <a class="btn primary" href="#howto" id="buyBtn" data-i18n="cta.buy">Buy FRED</a>
    </div>
  </div>
</header>

<main class="container">
  <!-- HERO -->
  <section class="hero">
    <div class="panel" style="position:relative; overflow:hidden">
      <div id="particles" class="particles" aria-hidden="true"></div>
      <h1 data-i18n="hero.title">‚ÄúYabba Dabba To The Moon!‚Äù üöÄüåï</h1>
      <p class="tagline" data-i18n="hero.subtitle">The Stone Age memecoin for the Crypto Era. <strong>1 Billion FREDs</strong> carved in stone. <strong>Community &gt; Technology</strong>.</p>
      <div class="row" style="margin-top:8px">
        <div class="pill" data-i18n="hero.p1">ü™® Prehistoric memes</div>
        <div class="pill" data-i18n="hero.p2">‚öíÔ∏è Forged by community</div>
        <div class="pill" data-i18n="hero.p3">üî• Fair launch</div>
      </div>

      <div style="margin-top:14px" class="panel">
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <input id="mint" class="kbd" value="SoLaNaMockMint11111111111111111111111111111" aria-label="Solana token mint (mock)" style="min-width:260px">
          <button id="copyMint" class="btn">Copy mint</button>
          <button id="viewExplorer" class="btn primary">View on Explorer</button>
        </div>
        <div style="margin-top:8px" class="muted">Mock mint for Solana network ‚Äî replace with your real token mint once available.</div>
      </div>

      <!-- NOVO: Slogan visual -->
      <img src="img/slogan.jpg" alt="FRED slogan" class="hero-slogan">
    </div>

    <div class="panel">
      <div class="rock float" aria-hidden="true">
        <img src="img/fred-logo-stone.png" 
             alt="FRED logo on stone" 
             class="fred-stone">
      </div>
      <div style="margin-top:12px" class="muted">
        Community > Technology ‚Äî be kind, create memes.
      </div>
    </div>

  </section>

  <!-- TOKENOMICS -->
  <section id="tokenomics">
    <h2 data-i18n="tokenomics.title">Tokenomics</h2>
    <div class="grid-cols cols-12" style="display:grid; grid-template-columns: 1fr 1fr; gap:18px">
      <div class="panel">
        <div class="row"><div class="muted">Total supply</div><div style="margin-left:auto" class="kbd">1,000,000,000 FRED</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Buy / Sell fee</div><div style="margin-left:auto" class="kbd">0% / 0%</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Network</div><div style="margin-left:auto" class="kbd">Solana</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Mint (mock)</div><div style="margin-left:auto" class="kbd" id="mintDisplay">SoLaNaMockMint11111111111111111111111111111</div></div>
      </div>
      <div class="panel">
        <div class="muted">Distribution</div>
        <div style="margin-top:10px">
          <div class="muted row"><div>DEX Liquidity</div><div style="margin-left:auto">60%</div></div>
          <div class="progress-thin" style="margin:8px 0"><i style="width:60%"></i></div>
          <div class="muted row"><div>Community & Airdrop</div><div style="margin-left:auto">20%</div></div>
          <div class="progress-thin" style="margin:8px 0"><i style="width:20%"></i></div>
          <div class="muted row"><div>Partnerships</div><div style="margin-left:auto">10%</div></div>
          <div class="progress-thin" style="margin:8px 0"><i style="width:10%"></i></div>
          <div class="muted row"><div>Treasury</div><div style="margin-left:auto">10%</div></div>
          <div class="progress-thin" style="margin:8px 0"><i style="width:10%"></i></div>
        </div>
        <div class="muted" style="margin-top:10px">Ownership renounced ‚Ä¢ Liquidity lock: planned</div>
      </div>
    </div>
  </section>

  <!-- ROCKMAP -->
  <section id="rockmap">
    <h2 data-i18n="rockmap.title">Rockmap</h2>
    <div class="grid-cols cols-12" style="display:grid; grid-template-columns:2fr 1fr; gap:18px">
      <div class="panel">
        <ul>
          <li>‚úÖ <strong>Phase 1 ‚Äî Pebble</strong>: site, token mint (mock), fair-launch, lock initial liquidity.</li>
          <li>üöß <strong>Phase 2 ‚Äî Rock</strong>: trackers, community airdrop, meme contests.</li>
          <li>üßó <strong>Phase 3 ‚Äî Mountain</strong>: creators, Stone Pass NFTs, bridges if needed.</li>
          <li>üåï <strong>Phase 4 ‚Äî Meteor</strong>: selected CEX listings, IRL meetups.</li>
        </ul>
      </div>
      <div class="panel">
        <div class="badge">Audit: pending</div>
        <div class="muted" style="margin-top:8px">Audits increase safety but do not remove all risks. DYOR.</div>
      </div>
    </div>
  </section>

  <!-- HOW TO BUY -->
  <section id="howto">
    <h2 data-i18n="howto.title">How to buy (Solana)</h2>
    <div class="grid-cols cols-12" style="display:grid; grid-template-columns:1fr 1fr; gap:18px">
      <div class="panel">
        <ol>
          <li data-i18n="howto.step1">Install a Solana wallet (Phantom, Solflare).</li>
          <li data-i18n="howto.step2">Fund it with SOL for fees.</li>
          <li data-i18n="howto.step3">Use a Solana DEX (e.g. Raydium, Jupiter) and add the token mint.</li>
          <li data-i18n="howto.step4">Set slippage (0.5‚Äì2%) and swap‚Äîbe careful.</li>
        </ol>
      </div>
      <div class="panel">
        <div class="muted">Useful links (replace with real)</div>
        <div style="margin-top:8px" class="row">
          <a class="btn" id="dexLink" href="#" target="_blank">Open DEX</a>
          <a class="btn" id="explorerLink" href="#" target="_blank">Token Explorer</a>
        </div>
        <div class="muted" style="margin-top:8px">This website is informational and not financial advice. Never invest more than you can lose.</div>
      </div>
    </div>
  </section>

  <!-- PLAY THE GAME -->
  <section id="play">
    <h2 data-i18n="play.title">Play the Meme Game ‚Äî Fred runs</h2>
    <div id="gamePanel" class="panel">
      <div class="scorebar">
        <div class="stat">üèÉ <strong id="playerName">Fred</strong></div>
        <div class="stat">Stones: <b id="stonesCount">0</b></div>
        <div class="stat">FRED Tokens (sim): <b id="tokensBalance">0</b></div>
        <div style="margin-left:auto" class="row">
          <button id="convertBtn" class="btn">Convert Stones ‚Üí FRED</button>
          <button id="resetRun" class="btn">Reset</button>
        </div>
      </div>

      <div class="canvas-wrap" aria-hidden="false" style="margin-top:12px">
        <canvas id="runnerCanvas" width="1200" height="480"></canvas>
      </div>

      <div style="margin-top:8px" class="muted">Collect <b>token coins</b> (logo) while avoiding obstacles. Stones = coins. Convert stones into simulated FRED tokens (UI only).</div>
    </div>
  </section>

  <!-- MEME GENERATOR -->
  <section id="meme">
    <h2 data-i18n="meme.title">Meme Generator</h2>
    <div class="grid-cols" style="display:grid; grid-template-columns:1fr 1fr; gap:18px">
      <div class="panel">
        <div class="row">
          <input id="memeFile" type="file" accept="image/*" class="kbd" />
          <input id="topText" placeholder="Top text" class="kbd" />
          <input id="bottomText" placeholder="Bottom text" class="kbd" />
          <button id="downloadMeme" class="btn primary">Download Meme</button>
        </div>
      </div>
      <div class="panel" style="display:flex;align-items:center;justify-content:center">
        <canvas id="memeCanvas" width="720" height="720" aria-label="Meme preview"></canvas>
      </div>
    </div>
  </section>

  <!-- COMMUNITY -->
  <section id="community">
    <h2 data-i18n="community.title">Community</h2>
    <div class="panel row">
      <a class="btn" href="https://x.com/" target="_blank">X (Twitter)</a>
      <a class="btn" href="https://t.me/" target="_blank">Telegram</a>
      <a class="btn" href="https://discord.gg/" target="_blank">Discord</a>
      <a class="btn" href="mailto:team@fredflintons.org">Contact</a>
    </div>
  </section>

  <footer>
    <div class="muted">¬© <span id="year"></span> Fred Flintons (FRED). Parody / meme project ‚Äî not affiliated with any trademarked characters.</div>
  </footer>
</main>

<script>
/* ========= Localization strings ========= */
const LOCALES = {
  en: {
    nav: { tokenomics: "Tokenomics", rockmap: "Rockmap", howto: "How to buy", play: "Play the Meme Game", meme: "Meme Generator", community: "Community" },
    cta: { buy: "Buy FRED" },
    hero: { title: "‚ÄúYabba Dabba To The Moon!‚Äù üöÄüåï", subtitle: "The Stone Age memecoin for the Crypto Era. 1 Billion FREDs carved in stone. Community > Technology.", p1:"ü™® Prehistoric memes", p2:"‚öíÔ∏è Forged by community", p3:"üî• Fair launch" },
    tokenomics: { title: "Tokenomics" },
    rockmap: { title: "Rockmap" },
    howto: { title: "How to buy (Solana)", step1: "Install a Solana wallet (Phantom, Solflare).", step2: "Fund it with SOL for fees.", step3: "Use a Solana DEX (Raydium, Jupiter) and add the token mint.", step4: "Set slippage and swap ‚Äî be careful." },
    play: { title: "Play the Meme Game ‚Äî Fred runs" },
    meme: { title: "Meme Generator" },
    community: { title: "Community" }
  },
  pt: {
    nav: { tokenomics: "Tokenomics", rockmap: "Rockmap", howto: "Como comprar", play: "Jogar", meme: "Gerador de Meme", community: "Comunidade" },
    cta: { buy: "Comprar FRED" },
    hero: { title: "‚ÄúYabba Dabba Para a Lua!‚Äù üöÄüåï", subtitle: "O memecoin da Idade da Pedra para a Era Cripto. 1 Bilh√£o de FREDs esculpidos na pedra. Comunidade > Tecnologia.", p1:"ü™® Memes pr√©-hist√≥ricos", p2:"‚öíÔ∏è Forjado pela comunidade", p3:"üî• Lan√ßamento justo" },
    tokenomics: { title: "Tokenomics" },
    rockmap: { title: "Rockmap" },
    howto: { title: "Como comprar (Solana)", step1: "Instale uma carteira Solana (Phantom, Solflare).", step2: "Carregue com SOL para as taxas.", step3: "Use um DEX (Raydium, Jupiter) e adicione o mint do token.", step4: "Ajuste slippage e troque ‚Äî tenha cuidado." },
    play: { title: "Jogar ‚Äî Fred corre" },
    meme: { title: "Gerador de Meme" },
    community: { title: "Comunidade" }
  }
};

/* ========= Utilities ========= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* ========= Language handling ========= */
const langSelect = $('#langSelect');
let lang = localStorage.getItem('fred_lang') || 'en';
langSelect.value = lang;
document.documentElement.setAttribute('data-lang', lang);
function applyLocale(l){
  const pack = LOCALES[l] || LOCALES.en;
  $$('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const path = key.split('.');
    let v = pack;
    for(const p of path){ v = v?.[p]; if(v===undefined) break; }
    if(v!==undefined) el.textContent = v;
  });
  $('[data-i18n="hero.p1"]').textContent = pack.hero.p1;
  $('[data-i18n="hero.p2"]').textContent = pack.hero.p2;
  $('[data-i18n="hero.p3"]').textContent = pack.hero.p3;
  document.querySelectorAll('h2[data-i18n]').forEach(h=>{
    const key = h.getAttribute('data-i18n').split('.');
    let v = pack;
    for(const p of key){ v = v?.[p]; if(v===undefined) break; }
    if(v!==undefined) h.textContent = v;
  });
  $('#howto').querySelectorAll('ol li').forEach((li,i)=>{
    const stepKey = `step${i+1}`;
    const v = pack.howto[stepKey];
    if(v) li.textContent = v;
  });
  $('#buyBtn').textContent = pack.cta.buy;
  document.documentElement.setAttribute('data-lang', l);
}
applyLocale(lang);
langSelect.addEventListener('change', e=>{
  lang = e.target.value;
  localStorage.setItem('fred_lang', lang);
  applyLocale(lang);
});

/* ========= Theme toggle (simple placeholder) ========= */
const themeBtn = $('#themeBtn');
let theme = localStorage.getItem('fred_theme') || 'dark';
themeBtn.addEventListener('click', ()=>{
  theme = theme === 'dark' ? 'light' : 'dark';
  localStorage.setItem('fred_theme', theme);
});

/* ========= Particles in hero ========= */
(function particles(){
  const box = $('#particles');
  if(!box) return;
  const n = 32;
  for(let i=0;i<n;i++){
    const el = document.createElement('i'); el.className = 'particle';
    const size = 3 + Math.random()*8; el.style.width = el.style.height = size + 'px';
    el.style.left = (Math.random()*100)+'%';
    el.style.bottom = (-10 - Math.random()*80)+'px';
    el.style.opacity = 0.25 + Math.random()*0.6;
    const dur = 4 + Math.random()*6;
    el.style.animation = `floatUp ${dur}s linear ${Math.random()*2}s infinite`;
    el.style.background = Math.random()>0.5 ? 'linear-gradient(180deg,var(--accent),var(--accent-2))' : 'linear-gradient(180deg,#f5f0de,#ffd27a)';
    box.appendChild(el);
  }
})();

/* ========= Copy mint & explorer (mock behavior) ========= */
$('#copyMint').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText($('#mint').value); $('#copyMint').textContent = 'Copied!'; setTimeout(()=>$('#copyMint').textContent='Copy mint',1200); }
  catch(e){ alert('Copy failed'); }
});
$('#viewExplorer').addEventListener('click', ()=>{
  const mint = $('#mint').value;
  const url = `https://explorer.solana.com/address/${encodeURIComponent(mint)}?cluster=devnet`;
  window.open(url,'_blank');
});
$('#dexLink').addEventListener('click', ()=> window.open('https://jup.ag/','_blank'));
$('#explorerLink').addEventListener('click', ()=> window.open('https://explorer.solana.com','_blank'));

/* ========= Meme generator (canvas) ========= */
(function memeGen(){
  const file = $('#memeFile'), top = $('#topText'), bottom = $('#bottomText'), canvas = $('#memeCanvas'), ctx = canvas.getContext('2d'), dl = $('#downloadMeme');
  let img = new Image();
  function draw(){
    ctx.fillStyle = '#0f0e0d'; ctx.fillRect(0,0,canvas.width,canvas.height);
    const pad = 12;
    if(img && img.naturalWidth){
      const scale = Math.min((canvas.width-2*pad)/img.naturalWidth, (canvas.height-2*pad)/img.naturalHeight);
      const w = img.naturalWidth * scale, h = img.naturalHeight * scale;
      const x = (canvas.width - w)/2, y = (canvas.height - h)/2;
      ctx.drawImage(img, x, y, w, h);
    } else {
      ctx.fillStyle = '#1a1614'; ctx.fillRect(pad,pad,canvas.width-2*pad, canvas.height-2*pad);
      ctx.fillStyle = '#ddd'; ctx.font = '600 20px system-ui'; ctx.textAlign='center';
      ctx.fillText('Choose an image to create a meme', canvas.width/2, canvas.height/2);
    }
    // texts
    ctx.textAlign='center'; ctx.lineJoin='round'; ctx.strokeStyle='black';
    const drawLines = (text, yStart, topFlag=true)=>{
      const lines = (text||'').toUpperCase().split('\n').slice(0,4);
      lines.forEach((ln,i)=>{
        const size = 48 - i*6;
        ctx.font = `900 ${size}px Impact, system-ui, sans-serif`;
        ctx.lineWidth = Math.max(6, size/12);
        ctx.strokeText(ln, canvas.width/2, topFlag ? yStart + i*size : yStart + i*size);
        ctx.fillStyle = 'white'; ctx.fillText(ln, canvas.width/2, topFlag ? yStart + i*size : yStart + i*size);
      });
    };
    drawLines(top.value, 64, true);
    drawLines(bottom.value, canvas.height - 140, false);
  }
  file.addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return;
    const url = URL.createObjectURL(f);
    img.onload = ()=>{ draw(); URL.revokeObjectURL(url); };
    img.src = url;
  });
  top.addEventListener('input', draw); bottom.addEventListener('input', draw);
  dl.addEventListener('click', ()=>{
    draw();
    const a = document.createElement('a'); a.href = canvas.toDataURL('image/png'); a.download = 'fred-meme.png'; a.click();
  });
  draw();
})();

/* ========= Runner game update: Fred sprite + token logo coins (v2 ‚Äì obst√°culos, game over, fases) ========= */
(function runner(){
  const canvas = $('#runnerCanvas');
  const ctx = canvas.getContext('2d');

  // responsive resize (mantido)
  function resize() {
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    canvas.width = Math.floor(w * devicePixelRatio);
    canvas.height = Math.floor(h * devicePixelRatio);
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  resize();
  window.addEventListener('resize', resize);

  // assets (mantidos)
  const fredImg = new Image(); fredImg.src = 'img/fred-sprite.png'; // spritesheet horizontal de 4 frames
  const coinImg = new Image(); coinImg.src = 'img/logo.png';

  // estado
  const state = {
    player: { x: 120, y: 0, w: 64, h: 64, vy:0, onGround:true },
    anim: { cols: 4, frame: 0, t: 0, fps: 10, fw: 64, fh: 64 },
    groundY: 0,

    // hazards agora tem tipos: 'rock' (bate e desacelera como antes), 'cactus' (letal), 'hole' (letal)
    obstacles: [],
    stones: [],

    // velocidades (mantidas + base ajust√°vel por n√≠vel)
    speed: 220,          // velocidade atual (px/s)
    baseSpeed: 220,      // alvo para easing
    spawnTimer: 0,
    spawnInterval: 1.2,  // ser√° reduzido conforme n√≠vel
    stoneTimer: 0,

    // pontua√ß√£o e progresso
    stonesCollected: Number(localStorage.getItem('fred_stones')||0),
    tokens: Number(localStorage.getItem('fred_tokens')||0),

    // competitividade
    runStones: 0,        // moedas coletadas nesta corrida
    bestRun: Number(localStorage.getItem('fred_best_run')||0),
    level: 1,

    last: 0,
    running: true,
    gameOver: false
  };

  // UI refs (mantidos)
  const stonesCount = $('#stonesCount');
  const tokensBalance = $('#tokensBalance');
  const convertBtn = $('#convertBtn');
  const resetRun = $('#resetRun');
  stonesCount.textContent = state.stonesCollected;
  tokensBalance.textContent = state.tokens;

  // f√≠sica (mantida)
  const GRAV = 1200;
  const JUMP_V = -520;

  /* ==================== NOVO: n√≠vel/dificuldade ==================== */
  function updateDifficulty(){
    // sobe de n√≠vel a cada 15 moedas da rodada
    const newLevel = Math.floor(state.runStones / 15) + 1;
    if(newLevel !== state.level){
      state.level = newLevel;
      // aumenta velocidade alvo e spawns ligeiramente
      state.baseSpeed = 220 + (state.level-1) * 25;
      state.spawnInterval = Math.max(0.75, 1.2 - (state.level-1)*0.08);
    }
  }

  /* ==================== Spawns ==================== */
  function spawnObstacle(){
    // Probabilidades: rock 45% (n√£o letal, s√≥ desacelera), cactus 30% (letal), hole 25% (letal)
    const r = Math.random();
    let type = 'rock';
    if(r > 0.75) type = 'hole';
    else if(r > 0.45) type = 'cactus';

    if(!state.groundY) state.groundY = canvas.height - 80;

    if(type === 'rock'){
      const h = 28 + Math.random()*36;
      const y = state.groundY - h;
      state.obstacles.push({
        type, x: canvas.width + 40, y, w: 36 + Math.random()*24, h,
        vx: -state.speed
      });
    } else if(type === 'cactus'){
      const h = 30 + Math.random()*10;
      const w = 20 + Math.random()*18;
      const y = state.groundY - h;
      state.obstacles.push({
        type, x: canvas.width + 40, y, w, h, vx: -state.speed*1.02
      });
    } else { // hole
      const w = 40 + Math.random()*10;
      // representamos buraco como "ret√¢ngulo" no ch√£o
      state.obstacles.push({
        type, x: canvas.width + 40, y: state.groundY - 6, w, h: 14, vx: -state.speed*0.95
      });
    }
  }

  function spawnStone(){
    const size = 18 + Math.random()*10;
    const y = state.groundY - 80 - Math.random()*120;
    state.stones.push({ x: canvas.width + 40, y, r: size, vx: -state.speed*0.9 });
  }

  /* ==================== Input ==================== */
  function tryJumpOrRestart(){
    if(state.gameOver){
      restartRun();
    } else if(state.player.onGround){
      state.player.vy = JUMP_V;
      state.player.onGround = false;
    }
  }
  window.addEventListener('keydown', e=>{
    if(e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); tryJumpOrRestart(); }
  });
  canvas.addEventListener('click', ()=> tryJumpOrRestart());
  canvas.addEventListener('touchstart', ()=> tryJumpOrRestart(), {passive:true});

  /* ==================== Helpers colis√£o ==================== */
  function rectIntersect(a,b){
    return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
  }
  function circleRectIntersect(cx,cy,r,rect){
    const nearestX = Math.max(rect.x, Math.min(cx, rect.x + rect.w));
    const nearestY = Math.max(rect.y, Math.min(cy, rect.y + rect.h));
    const dx = cx - nearestX, dy = cy - nearestY;
    return (dx*dx + dy*dy) <= (r*r);
  }

  /* ==================== Game Over & Restart ==================== */
  function die(reason=''){
    if(state.gameOver) return;
    state.gameOver = true;
    state.running = false;

    // perde as moedas da rodada (n√£o vai abaixo de 0)
    if(state.runStones>0){
      state.stonesCollected = Math.max(0, state.stonesCollected - state.runStones);
      localStorage.setItem('fred_stones', state.stonesCollected);
      stonesCount.textContent = state.stonesCollected;
    }

    // best run (maior n√∫mero de moedas em uma √∫nica corrida)
    if(state.runStones > state.bestRun){
      state.bestRun = state.runStones;
      localStorage.setItem('fred_best_run', state.bestRun);
    }
  }

  function restartRun(){
    // mant√©m tokens; mant√©m pedras j√° persistidas (menos as perdidas no die)
    state.obstacles.length = 0;
    state.stones.length = 0;
    state.speed = 220;
    state.baseSpeed = 220;
    state.spawnInterval = 1.2;
    state.level = 1;
    state.runStones = 0;

    state.player.y = state.groundY - state.player.h;
    state.player.vy = 0;
    state.player.onGround = true;

    state.last = performance.now();
    state.running = true;
    state.gameOver = false;
  }

  /* ==================== Loop ==================== */
  function update(t){
    if(!state.last) state.last = t;
    const dt = Math.min(0.033, (t - state.last)/1000);
    state.last = t;

    if(!state.running){
      render(); // para mostrar overlay mesmo pausado
      requestAnimationFrame(update);
      return;
    }

    // anima√ß√£o sprite
    state.anim.t += dt;
    if(state.anim.t >= 1/state.anim.fps){
      state.anim.t = 0;
      state.anim.frame = (state.anim.frame + 1) % state.anim.cols;
    }

    // timers
    state.spawnTimer -= dt;
    state.stoneTimer -= dt;
    if(state.spawnTimer <= 0){
      spawnObstacle();
      state.spawnTimer = state.spawnInterval * (0.7 + Math.random()*0.6);
    }
    if(state.stoneTimer <= 0){
      spawnStone();
      state.stoneTimer = 0.8 + Math.random()*1.6;
    }

    // f√≠sica player
    state.player.vy += GRAV * dt;
    state.player.y += state.player.vy * dt;
    if(!state.groundY) state.groundY = canvas.height - 80;
    if(state.player.y + state.player.h >= state.groundY){
      state.player.y = state.groundY - state.player.h;
      state.player.vy = 0;
      state.player.onGround = true;
    }

    // mover entidades
    for(const o of state.obstacles) o.x += o.vx * dt;
    for(const s of state.stones) s.x += s.vx * dt;

    // cull off-screen
    state.obstacles = state.obstacles.filter(o=> o.x + o.w > -50 );
    state.stones = state.stones.filter(s=> s.x + s.r > -50 );

    // colis√µes com obst√°culos
    for(const o of state.obstacles){
      const pRect = {x: state.player.x, y: state.player.y, w: state.player.w, h: state.player.h};
      if(o.type === 'hole'){
        // se o p√© do player estiver na faixa do buraco, morre
        const playerFootY = state.player.y + state.player.h;
        const overlapX = !(pRect.x + pRect.w < o.x || pRect.x > o.x + o.w);
        if(overlapX && playerFootY >= state.groundY - 2){
          die('hole');
          break;
        }
      } else if(o.type === 'cactus'){
        if(rectIntersect(pRect, o)){
          die('cactus');
          break;
        }
      } else { // rock mant√©m comportamento antigo: desacelera e d√° bounce
        if(rectIntersect(pRect, o)){
          state.speed = Math.max(120, state.speed - 40);
          state.player.vy = -220; // bounce
        }
      }
    }

    // coletar moedas (stones)
    for(let i = state.stones.length-1; i>=0; i--){
      const s = state.stones[i];
      if(circleRectIntersect(s.x, s.y, s.r, { x: state.player.x, y: state.player.y, w: state.player.w, h: state.player.h })){
        state.stonesCollected += 1;
        state.runStones += 1;
        localStorage.setItem('fred_stones', state.stonesCollected);
        state.stones.splice(i,1);
        stonesCount.textContent = state.stonesCollected;
        // leve aumento de velocidade por moeda
        state.speed = Math.min(520, state.speed + 8);
      }
    }

    // ajustar dificuldade conforme moedas da rodada
    updateDifficulty();

    // easing da velocidade para a base que cresce com n√≠vel
    state.speed += (state.baseSpeed - state.speed) * dt * 0.25;

    render();
    requestAnimationFrame(update);
  }

  /* ==================== Render ==================== */
  function render(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // bg
    ctx.fillStyle = '#0f0e0d'; ctx.fillRect(0,0,canvas.width,canvas.height);
    // ground
    const gY = state.groundY;
    ctx.fillStyle = '#1b1714'; ctx.fillRect(0, gY, canvas.width, canvas.height - gY);
    for(let i=0;i<canvas.width;i+=48){
      ctx.fillStyle = '#3b342f';
      ctx.beginPath(); ctx.ellipse(i + (state.last/50)%48, gY + 18, 14, 10, 0, 0, Math.PI*2); ctx.fill();
    }

    // obst√°culos (tipos distintos)
    for(const o of state.obstacles){
      if(o.type === 'hole'){
        // buraco como "fenda" escura + borda
        ctx.fillStyle = '#070606';
        ctx.fillRect(o.x, o.y, o.w, o.h);
        ctx.fillStyle = '#2b2118';
        ctx.fillRect(o.x, o.y-2, o.w, 2);
      } else if(o.type === 'cactus'){
        ctx.fillStyle = '#2f8f2f';
        ctx.fillRect(o.x + o.w*0.35, o.y, o.w*0.3, o.h); // tronco
        // "bra√ßos"
        ctx.fillRect(o.x, o.y + o.h*0.45, o.w*0.35, 10);
        ctx.fillRect(o.x + o.w*0.65, o.y + o.h*0.30, o.w*0.35, 10);
      } else { // rock (visual antigo)
        ctx.fillStyle = '#6d5848';
        ctx.beginPath(); ctx.ellipse(o.x + o.w/2, o.y + o.h/2, o.w/2, o.h/2, 0,0,Math.PI*2); ctx.fill();
        ctx.fillStyle = '#2b2118'; ctx.font = 'bold 12px system-ui'; ctx.textAlign='center';
        ctx.fillText('rock', o.x + o.w/2, o.y + o.h/2 + 4);
      }
    }

    // coins (logo)
    for(const s of state.stones){
      const size = s.r*2;
      ctx.save();
      ctx.translate(s.x - size/2, s.y - size/2);
      if(coinImg.complete && coinImg.naturalWidth) {
        ctx.drawImage(coinImg, 0, 0, size, size);
      } else {
        ctx.fillStyle = 'goldenrod'; ctx.beginPath(); ctx.arc(size/2, size/2, size/2, 0, Math.PI*2); ctx.fill();
      }
      ctx.restore();
    }

    // player (sprite ou fallback)
    const p = state.player;
    const a = state.anim;
    ctx.save();
    const fw = (fredImg.complete && fredImg.naturalWidth) ? (fredImg.naturalWidth / a.cols) : a.fw;
    const fh = (fredImg.complete && fredImg.naturalHeight) ? fredImg.naturalHeight : a.fh;
    const sx = a.frame * fw, sy = 0;
    if(fredImg.complete && fredImg.naturalWidth){
      ctx.drawImage(fredImg, sx, sy, fw, fh, p.x, p.y, p.w, p.h);
    } else {
      ctx.fillStyle = '#c8b08f'; ctx.fillRect(p.x, p.y, p.w, p.h);
    }
    ctx.restore();

    // HUD extra: n√≠vel e melhor corrida (desenhado no canvas para n√£o mexer no HTML)
    ctx.fillStyle = '#ddd'; ctx.font = '600 14px system-ui'; ctx.textAlign='left';
    ctx.fillText('Speed: ' + Math.round(state.speed) + ' px/s', 90, 28);
    ctx.fillText('Level: ' + state.level, 90, 48);
    ctx.fillText('Best run: ' + state.bestRun, 90, 68);

    // overlay de game over
    if(state.gameOver){
      ctx.fillStyle = 'rgba(0,0,0,0.6)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#fff'; ctx.textAlign='center';
      ctx.font = 'bold 42px system-ui';
      ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 10);
      ctx.font = '600 18px system-ui';
      ctx.fillText(`Coins lost this run: ${state.runStones}`, canvas.width/2, canvas.height/2 + 22);
      ctx.fillText('Press SPACE / CLICK to restart', canvas.width/2, canvas.height/2 + 50);
    }
  }

  /* ==================== Convers√£o (mantida) ==================== */
  convertBtn.addEventListener('click', ()=>{
    const rate = 5; // 5 coins -> 1 FRED token (sim)
    if(state.stonesCollected < rate){ alert('Not enough stones to convert.'); return; }
    const coins = Math.floor(state.stonesCollected / rate);
    state.tokens += coins;
    state.stonesCollected -= coins * rate;
    localStorage.setItem('fred_tokens', state.tokens);
    localStorage.setItem('fred_stones', state.stonesCollected);
    $('#stonesCount').textContent = state.stonesCollected;
    $('#tokensBalance').textContent = state.tokens;
  });

  resetRun.addEventListener('click', ()=>{
    if(confirm('Reset run progress (stones & tokens saved separately)?')){
      state.stonesCollected = 0; state.tokens = 0;
      state.runStones = 0; state.bestRun = 0;
      localStorage.removeItem('fred_stones'); localStorage.removeItem('fred_tokens'); localStorage.removeItem('fred_best_run');
      $('#stonesCount').textContent = 0; $('#tokensBalance').textContent = 0;
      state.obstacles=[]; state.stones=[]; state.speed=220; state.baseSpeed=220; state.level=1; state.spawnInterval=1.2;
    }
  });

  requestAnimationFrame(update);
})();

/* ========= small helpers & year ========= */
$('#year').textContent = new Date().getFullYear();

/* ========= Smooth in-page anchors ========= */
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    const id = a.getAttribute('href').substring(1);
    const el = document.getElementById(id);
    if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); el.focus({preventScroll:true}); }
  });
});
</script>
</body>
</html>
